version: '3'
services:
  master:
    container_name: '${COMPOSE_PROJECT_NAME:-citus}_master'
    image: 'citusdata/citus:9.5.1'
    ports:
      - '${MASTER_EXTERNAL_PORT:-5432}:5432'
    labels:
      - com.citusdata.role=Master
    environment:
      POSTGRES_USER: '${POSTGRES_USER:-postgres}'
      POSTGRES_PASSWORD: '${POSTGRES_PASSWORD}'
      PGUSER: '${POSTGRES_USER:-postgres}'
      PGPASSWORD: '${POSTGRES_PASSWORD}'
      POSTGRES_HOST_AUTH_METHOD: '${POSTGRES_HOST_AUTH_METHOD:-trust}'
  worker:
    image: 'citusdata/citus:9.5.1'
    labels:
      - com.citusdata.role=Worker
    depends_on:
      - manager
    environment:
      POSTGRES_USER: '${POSTGRES_USER:-postgres}'
      POSTGRES_PASSWORD: '${POSTGRES_PASSWORD}'
      PGUSER: '${POSTGRES_USER:-postgres}'
      PGPASSWORD: '${POSTGRES_PASSWORD}'
      POSTGRES_HOST_AUTH_METHOD: '${POSTGRES_HOST_AUTH_METHOD:-trust}'
    command: /wait-for-manager.sh
    volumes:
      - 'healthcheck-volume:/healthcheck'
  manager:
    container_name: '${COMPOSE_PROJECT_NAME:-citus}_manager'
    image: 'citusdata/membership-manager:0.3.0'
    volumes:
      - '${DOCKER_SOCK:-/var/run/docker.sock}:/var/run/docker.sock'
      - 'healthcheck-volume:/healthcheck'
    depends_on:
      - master
    environment:
      POSTGRES_USER: '${POSTGRES_USER:-postgres}'
      POSTGRES_PASSWORD: '${POSTGRES_PASSWORD}'
      PGUSER: '${POSTGRES_USER:-postgres}'
      PGPASSWORD: '${POSTGRES_PASSWORD}'
      POSTGRES_HOST_AUTH_METHOD: '${POSTGRES_HOST_AUTH_METHOD:-trust}'
volumes:
  healthcheck-volume: null
